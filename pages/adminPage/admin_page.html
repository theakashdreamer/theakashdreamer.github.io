<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Quill.js -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="./assets/css/adminpage.css" />

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      getDocs,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvvZQjQTbvM-l1CrfeAmXO-vykBnJOexk",
      authDomain: "registration-93e51.firebaseapp.com",
      projectId: "registration-93e51",
      storageBucket: "registration-93e51.firebasestorage.app",
      messagingSenderId: "509440941274",
      appId: "1:509440941274:web:ae0ebbd4ceadca0a4dd9e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.serverTimestamp = serverTimestamp;
    window.getDocs = getDocs;
    window.doc = doc;
    window.getDoc = getDoc;
    window.setDoc = setDoc;
  </script>
</head>

<body>
  <div class="container">

    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-cogs"></i></div>
        <h1>Admin Dashboard</h1>
      </div>
      <div class="admin-info">
        <i class="fas fa-user-circle"></i>
        <span>Administrator</span>
      </div>
    </header>

    <!-- STATS -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon" style="background:linear-gradient(135deg,#8b5cf6,#3b82f6)">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-info">
          <h3 id="portfolioCount">0</h3>
          <p>Portfolio Items</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background:linear-gradient(135deg,#f59e0b,#f97316)">
          <i class="fas fa-newspaper"></i>
        </div>
        <div class="stat-info">
          <h3 id="blogCount">0</h3>
          <p>Blog Posts</p>
        </div>
      </div>
    </div>

    <!-- DASHBOARD GRID -->
    <div class="dashboard-grid">
      <!-- RESUME CARD -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon portfolio-icon"><i class="fas fa-graduation-cap"></i></div>
            <span>Resume Manager</span>
          </div>
        </div>

        <form id="resumeForm">
          <select id="resumeType" required>
            <option value="">Select Section</option>
            <option value="education">Education</option>
            <option value="experience">Experience</option>
            <option value="skills">Skills</option>
          </select>

          <input id="rTitle" placeholder="Title / Skill Name" required />
          <input id="rDuration" placeholder="Duration (optional)" />
          <input id="rPercent" type="number" placeholder="Skill % (only for skills)" />
          <textarea id="rDescription" placeholder="Description"></textarea>

          <button class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Item
          </button>

          <div class="success-message" id="rSuccess">Resume updated!</div>
        </form>
      </div>

      <!-- PROFILE CARD -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon portfolio-icon"><i class="fas fa-user-edit"></i></div>
            <span>Edit Profile</span>
          </div>
        </div>

        <form id="profileForm">
          <input id="prName" placeholder="Name" required />
          <input id="prTitle" placeholder="Title" required />
          <input id="prAvatar" placeholder="Avatar URL" required />
          <input id="prEmail" placeholder="Email" required />
          <input id="prPhone" placeholder="Phone" required />
          <input id="prBirthday" placeholder="Birthday" />
          <input id="prLocation" placeholder="Location" />
          <input id="prFacebook" placeholder="Facebook" />
          <input id="prLinkedin" placeholder="LinkedIn" />
          <input id="prInstagram" placeholder="Instagram" />

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Profile
          </button>

          <div class="success-message" id="profileSuccess">
            <i class="fas fa-check-circle"></i>
            Profile updated successfully!
          </div>
        </form>
      </div>

      <!-- PORTFOLIO CARD -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon portfolio-icon"><i class="fas fa-briefcase"></i></div>
            <span>Add Portfolio</span>
          </div>
        </div>

        <form id="portfolioForm">
          <input id="pTitle" placeholder="Project Title" required />
          <input id="pImage" placeholder="Image URL" required />
          <select id="pCategory" required>
            <option value="">Select Category</option>
            <option>Applications</option>
            <option>Web design</option>
            <option>Web development</option>
          </select>

          <button id="portfolioBtn" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Portfolio
          </button>

          <div class="success-message" id="pSuccess">Portfolio added!</div>
        </form>
      </div>

      <!-- BLOG CARD -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon blog-icon"><i class="fas fa-blog"></i></div>
            <span>Add Blog</span>
          </div>
        </div>

        <form id="blogForm">
          <input id="bTitle" placeholder="Blog Title" required />
          <input id="bImage" placeholder="Image URL" required />
          <input id="bVideo" placeholder="YouTube Video ID" />
          <input id="bCategory" placeholder="Category" required />
          <input id="bDate" type="date" required />
          <div id="editor-container"></div>
          <input type="hidden" id="bContent" required />

          <button id="blogBtn" class="btn btn-secondary">
            <i class="fas fa-paper-plane"></i> Publish Blog
          </button>

          <div class="success-message" id="bSuccess">Blog published!</div>
        </form>
      </div>

    </div>
  </div>

  <!-- QUILL -->
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

  <!-- MAIN SCRIPT -->
  <script>
    const quill = new Quill('#editor-container', { theme: 'snow' });
    quill.on('text-change', () => bContent.value = quill.root.innerHTML);
    bDate.valueAsDate = new Date();

    async function updateStats() {
      portfolioCount.textContent = (await getDocs(collection(db, "portfolio"))).size;
      blogCount.textContent = (await getDocs(collection(db, "blogs"))).size;
    }

    async function loadProfileAdmin() {
      const snap = await getDoc(doc(db, "profile", "main"));
      if (!snap.exists()) return;
      const d = snap.data();
      prName.value = d.name || ""; prTitle.value = d.title || ""; prAvatar.value = d.avatar || "";
      prEmail.value = d.email || ""; prPhone.value = d.phone || "";
      prBirthday.value = d.birthday || ""; prLocation.value = d.location || "";
      prFacebook.value = d.socials?.facebook || "";
      prLinkedin.value = d.socials?.linkedin || "";
      prInstagram.value = d.socials?.instagram || "";
    }

    profileForm.onsubmit = async e => {
      e.preventDefault();
      await setDoc(doc(db, "profile", "main"), {
        name: prName.value, title: prTitle.value, avatar: prAvatar.value,
        email: prEmail.value, phone: prPhone.value, birthday: prBirthday.value,
        location: prLocation.value,
        socials: { facebook: prFacebook.value, linkedin: prLinkedin.value, instagram: prInstagram.value }
      });
      profileSuccess.classList.add("show");
      setTimeout(() => profileSuccess.classList.remove("show"), 4000);
    };

    portfolioForm.onsubmit = async e => {
      e.preventDefault();
      await addDoc(collection(db, "portfolio"), {
        title: pTitle.value, image: pImage.value, category: pCategory.value,
        createdAt: serverTimestamp()
      });
      pSuccess.classList.add("show");
      updateStats();
    };

    blogForm.onsubmit = async e => {
      e.preventDefault();
      if (!quill.getText().trim()) return alert("Add blog content");
      await addDoc(collection(db, "blogs"), {
        title: bTitle.value, image: bImage.value, videoId: bVideo.value,
        category: bCategory.value, description: bContent.value,
        date: bDate.value, createdAt: serverTimestamp()
      });
      bSuccess.classList.add("show");
      updateStats();
    };

    document.addEventListener("DOMContentLoaded", () => {
      updateStats();
      loadProfileAdmin();
    });


    
    resumeForm.onsubmit = async (e) => {
      e.preventDefault();

      const type = resumeType.value;
      const ref = doc(db, "resume", type);
      const snap = await getDoc(ref);

      let items = snap.exists() ? snap.data().items : [];

      if (type === "skills") {
        items.push({
          name: rTitle.value,
          percent: Number(rPercent.value || 0)
        });
      } else {
        items.push({
          title: rTitle.value,
          duration: rDuration.value,
          description: rDescription.value
        });
      }

      await setDoc(ref, { items });

      rSuccess.classList.add("show");
      setTimeout(() => rSuccess.classList.remove("show"), 3000);

      resumeForm.reset();
    };

  </script>
</body>

</html>