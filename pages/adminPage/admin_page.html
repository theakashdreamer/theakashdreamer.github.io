<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <!-- Quill.js for rich text editor -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!--
    - custom css link
  -->
  <link rel="stylesheet" href="./assets/css/adminpage.css" />
  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvvZQjQTbvM-l1CrfeAmXO-vykBnJOexk",
      authDomain: "registration-93e51.firebaseapp.com",
      projectId: "registration-93e51",
      storageBucket: "registration-93e51.firebasestorage.app",
      messagingSenderId: "509440941274",
      appId: "1:509440941274:web:ae0ebbd4ceadca0a4dd9e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.addDoc = addDoc;
    window.collection = collection;
    window.serverTimestamp = serverTimestamp;
    window.getDocs = getDocs;
  </script>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-cogs"></i>
        </div>
        <h1>Admin Dashboard</h1>
      </div>
      
      <div class="admin-info">
        <i class="fas fa-user-circle"></i>
        <span>Administrator</span>
      </div>
    </header>
    
    <!-- Stats -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #3b82f6);">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-info">
          <h3 id="portfolioCount">0</h3>
          <p>Portfolio Items</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #f97316);">
          <i class="fas fa-newspaper"></i>
        </div>
        <div class="stat-info">
          <h3 id="blogCount">0</h3>
          <p>Blog Posts</p>
        </div>
      </div>
    </div>
    
    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      
      <!-- Portfolio Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon portfolio-icon">
              <i class="fas fa-briefcase"></i>
            </div>
            <span>Add Portfolio</span>
          </div>
          <div class="card-badge">
            <i class="fas fa-plus-circle"></i>
          </div>
        </div>
        
        <form id="portfolioForm">
          <div class="form-group">
            <label class="form-label" for="pTitle">Project Title</label>
            <input type="text" placeholder="Enter project title" required id="pTitle">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="pImage">Image URL</label>
            <input type="text" placeholder="https://example.com/image.jpg" required id="pImage">
            <span class="helper-text">Paste the direct URL to your project image</span>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="pCategory">Category</label>
            <select id="pCategory" required>
              <option value="">Select Category</option>
              <option value="Applications">Applications</option>
              <option value="Web design">Web Design</option>
              <option value="Web development">Web Development</option>
              <option value="Mobile Apps">Mobile Apps</option>
              <option value="UI/UX Design">UI/UX Design</option>
            </select>
          </div>
          
          <button type="submit" class="btn btn-primary" id="portfolioBtn">
            <i class="fas fa-plus"></i> Add Portfolio Item
          </button>
          
          <div class="success-message" id="pSuccess">
            <i class="fas fa-check-circle"></i>
            <span>Portfolio added successfully!</span>
          </div>
        </form>
      </div>
      
      <!-- Blog Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <div class="card-icon blog-icon">
              <i class="fas fa-blog"></i>
            </div>
            <span>Add Blog Post</span>
          </div>
          <div class="card-badge">
            <i class="fas fa-edit"></i>
          </div>
        </div>
        
        <form id="blogForm">
          <div class="form-group">
            <label class="form-label" for="bTitle">Blog Title</label>
            <input type="text" placeholder="Enter blog title" required id="bTitle">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="bImage">Featured Image URL</label>
            <input type="text" placeholder="https://example.com/featured-image.jpg" required id="bImage">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="bVideo">YouTube Video ID</label>
            <input type="text" placeholder="dQw4w9WgXcQ" id="bVideo">
            <span class="helper-text">Optional: Only the video ID after "v=" in YouTube URL</span>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="bCategory">Category</label>
            <input type="text" placeholder="Technology, Design, Business, etc." required id="bCategory">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="bDate">Publication Date</label>
            <input type="date" required id="bDate">
          </div>
          
          <div class="form-group">
            <label class="form-label">Blog Content</label>
            <div id="editor-container"></div>
            <input type="hidden" id="bContent" required>
          </div>
          
          <button type="submit" class="btn btn-secondary" id="blogBtn">
            <i class="fas fa-paper-plane"></i> Publish Blog Post
          </button>
          
          <div class="success-message" id="bSuccess">
            <i class="fas fa-check-circle"></i>
            <span>Blog published successfully!</span>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Quill.js Library -->
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  
  <!-- Main Script -->
  <script>
    // Initialize Quill Editor
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'indent': '-1'}, { 'indent': '+1' }],
          [{ 'color': [] }, { 'background': [] }],
          ['link', 'image', 'video'],
          ['clean']
        ]
      },
      placeholder: 'Write your blog content here...'
    });
    
    // Update hidden input with Quill content
    quill.on('text-change', function() {
      document.getElementById('bContent').value = quill.root.innerHTML;
    });
    
    // Set default date to today
    document.getElementById('bDate').valueAsDate = new Date();
    
    // Fetch and update stats
    async function updateStats() {
      try {
        // Get portfolio count
        const portfolioSnapshot = await window.getDocs(window.collection(window.db, "portfolio"));
        document.getElementById('portfolioCount').textContent = portfolioSnapshot.size;
        
        // Get blog count
        const blogSnapshot = await window.getDocs(window.collection(window.db, "blogs"));
        document.getElementById('blogCount').textContent = blogSnapshot.size;
      } catch (error) {
        console.error("Error fetching stats:", error);
      }
    }
    
    // Portfolio form submission
    document.getElementById("portfolioForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById("portfolioBtn");
      const originalText = btn.innerHTML;
      btn.innerHTML = '<div class="spinner"></div> Adding...';
      btn.disabled = true;
      
      try {
        await window.addDoc(
          window.collection(window.db, "portfolio"),
          {
            title: document.getElementById("pTitle").value,
            image: document.getElementById("pImage").value,
            category: document.getElementById("pCategory").value,
            createdAt: window.serverTimestamp()
          }
        );
        
        // Show success message
        const successMsg = document.getElementById("pSuccess");
        successMsg.classList.add("show");
        
        // Reset form
        e.target.reset();
        
        // Update stats
        await updateStats();
        
        // Hide success message after 5 seconds
        setTimeout(() => {
          successMsg.classList.remove("show");
        }, 5000);
        
      } catch (error) {
        console.error("Error adding portfolio:", error);
        alert("Error adding portfolio. Check console for details.");
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    });
    
    // Blog form submission
    document.getElementById("blogForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      // Validate that Quill editor has content
      if (!quill.getText().trim()) {
        alert("Please add some content to your blog post.");
        return;
      }
      
      const btn = document.getElementById("blogBtn");
      const originalText = btn.innerHTML;
      btn.innerHTML = '<div class="spinner"></div> Publishing...';
      btn.disabled = true;
      
      try {
        await window.addDoc(
          window.collection(window.db, "blogs"),
          {
            title: document.getElementById("bTitle").value,
            image: document.getElementById("bImage").value,
            videoId: document.getElementById("bVideo").value || "",
            category: document.getElementById("bCategory").value,
            description: document.getElementById("bContent").value,
            date: document.getElementById("bDate").value,
            createdAt: window.serverTimestamp()
          }
        );
        
        // Show success message
        const successMsg = document.getElementById("bSuccess");
        successMsg.classList.add("show");
        
        // Reset form
        e.target.reset();
        quill.setContents([]);
        document.getElementById('bDate').valueAsDate = new Date();
        
        // Update stats
        await updateStats();
        
        // Hide success message after 5 seconds
        setTimeout(() => {
          successMsg.classList.remove("show");
        }, 5000);
        
      } catch (error) {
        console.error("Error adding blog:", error);
        alert("Error adding blog. Check console for details.");
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    });
    
    // Initialize stats on page load
    document.addEventListener('DOMContentLoaded', updateStats);
  </script>
</body>
</html>